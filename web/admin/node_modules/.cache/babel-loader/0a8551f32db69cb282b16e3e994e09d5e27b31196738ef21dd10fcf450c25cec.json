{"ast":null,"code":"const columns = [{\n  title: 'ID',\n  dataIndex: 'ID',\n  width: '10%',\n  key: 'id',\n  align: 'center'\n}, {\n  title: '用户名',\n  dataIndex: 'username',\n  width: '20%',\n  key: 'username',\n  align: 'center'\n}, {\n  title: '角色',\n  dataIndex: 'role',\n  width: '20%',\n  key: 'role',\n  align: 'center',\n  scopedSlots: {\n    customRender: 'role'\n  }\n}, {\n  title: '操作',\n  width: '30%',\n  key: 'action',\n  align: 'center',\n  scopedSlots: {\n    customRender: 'action'\n  }\n}];\nexport default {\n  data() {\n    return {\n      pagination: {\n        pageSizeOptions: ['5', '10', '20'],\n        defaultCurrent: 1,\n        defaultPageSize: 5,\n        total: 0,\n        showSizeChanger: true,\n        showTotal: total => `共${total}条`\n      },\n      userList: [],\n      columns,\n      queryParam: {\n        username: '',\n        pagesize: 5,\n        pagenum: 1\n      },\n      userinfo: {\n        id: 0,\n        username: '',\n        password: '',\n        checkpass: '',\n        role: 2\n      },\n      userRules: {\n        password: [{\n          validator: (rule, value, callback) => {\n            if (value === '') {\n              callback(new Error('请输入密码'));\n            }\n            if (value.length < 6 || value.length > 20) {\n              callback(new Error('密码应当在6到20为之间'));\n            } else {\n              callback();\n            }\n          },\n          trigger: 'blur'\n        }]\n      },\n      addUserVisible: false,\n      visible: false\n    };\n  },\n  created() {\n    this.getUserList();\n  },\n  methods: {\n    async getUserList() {\n      const {\n        data: res\n      } = await this.$http.get('users', {\n        params: {\n          username: this.queryParam.username,\n          pagesize: this.queryParam.pagesize,\n          pagenum: this.queryParam.pagenum\n        }\n      });\n      if (res.status !== 200) return this.$message.error(res.message);\n      this.userList = res.data;\n      this.pagination.total = res.total;\n    },\n    // 修改分页时触发\n    handleTableChange(pagination, filters, sorter) {\n      const pager = this.pagination;\n      pager.current = pagination.current;\n      pager.pageSize = pagination.pageSize;\n      this.queryParam.pagesize = pagination.pageSize;\n      this.queryParam.pagenum = pagination.current;\n      if (pagination.pageSize !== this.pagination.pageSize) {\n        this.queryParam.pagenum = 1;\n        pager.current = 1;\n      }\n      this.pagination = pager;\n      this.getUserList();\n    },\n    // 删除用户\n    deleteUser(id) {\n      this.$confirm({\n        title: '确定删除该用户吗？',\n        content: '一旦删除，无法恢复',\n        onOk: async () => {\n          const res = await this.$http.delete(`user/${id}`);\n          console.log(res);\n          if (res.status !== 200) return this.$message.error(res.message);\n          this.$message.success('删除成功');\n          this.getUserList();\n        },\n        onCancel: async () => {\n          this.$message.info('已取消删除');\n        }\n      });\n    },\n    // 新增用户\n    addUserOk() {},\n    addUserCancel() {\n      this.addUserVisible = false;\n    },\n    adminChange(value) {\n      this.userinfo.role = value;\n      console.log(this.userinfo.role);\n    }\n  }\n};","map":{"version":3,"names":["columns","title","dataIndex","width","key","align","scopedSlots","customRender","data","pagination","pageSizeOptions","defaultCurrent","defaultPageSize","total","showSizeChanger","showTotal","userList","queryParam","username","pagesize","pagenum","userinfo","id","password","checkpass","role","userRules","validator","rule","value","callback","Error","length","trigger","addUserVisible","visible","created","getUserList","methods","res","$http","get","params","status","$message","error","message","handleTableChange","filters","sorter","pager","current","pageSize","deleteUser","$confirm","content","onOk","delete","console","log","success","onCancel","info","addUserOk","addUserCancel","adminChange"],"sources":["src/components/user/UserList.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <h3>用户列表</h3>\r\n        <a-card>\r\n            <a-row :gutter=\"20\">\r\n                <a-col :span=\"6\">\r\n                    <a-input-search\r\n                    v-model=\"queryParam.username\"\r\n                    placeholder=\"输入用户名查找\"\r\n                    enter-button\r\n                    allowClear\r\n                    @search=\"getUserList\"/>\r\n                </a-col>\r\n                <a-col :span=\"4\">\r\n                    <a-button type=\"primary\" @click=\"addUserVisible=true\">新增</a-button>\r\n                </a-col>\r\n            </a-row>\r\n\r\n            <a-table\r\n            :columns=\"columns\"\r\n            :pagination='pagination'\r\n            :dataSource=\"userList\"\r\n            rowKey=\"ID\"\r\n            bordered\r\n            @change=\"handleTableChange\"\r\n            >\r\n            <span slot=\"role\" slot-scope=\"role\">{{ role==1?'管理员':'订阅者' }}</span>\r\n            <template slot=\"action\" slot-scope=\"data\">\r\n                <div class=\"actionSlot\">\r\n                    <a-button type=\"primary\" style=\"margin-right:15px\">编辑</a-button>\r\n                    <a-button type=\"danger\" @click=\"deleteUser(data.ID)\">删除</a-button>\r\n                </div>\r\n            </template>\r\n            </a-table>\r\n        </a-card>\r\n      <!--   新增用户区域   -->\r\n      <a-modal\r\n      closable\r\n      :visible=\"addUserVisible\"\r\n      title=\"新增用户\"\r\n      :confirm-loading=\"confirmLoading\"\r\n      @ok=\"addUserOk\"\r\n      @cancel=\"addUserCancel\"\r\n      >\r\n      <a-form-model :model=\"userinfo\" :rules=\"userRules\" ref=\"addUserRef\">\r\n        <a-form-model-item label=\"用户名\" prop=\"username\">\r\n          <a-input v-model=\"userinfo.username\"></a-input>\r\n        </a-form-model-item>\r\n        <a-form-model-item label=\"密码\" prop=\"password\">\r\n          <a-input-password v-model=\"userinfo.password\"></a-input-password>\r\n        </a-form-model-item>\r\n        <a-form-model-item label=\"确认密码\" prop=\"checkpass\">\r\n          <a-input-password v-model=\"userinfo.checkpass\"></a-input-password>\r\n        </a-form-model-item>\r\n        <a-form-model-item label=\"是否为管理员\" prop=\"role\">\r\n          <a-select defaultValue=\"2\" style=\"120px\" @change=\"adminChange\">\r\n            <a-select-option key=\"1\" value=\"1\">是</a-select-option>\r\n            <a-select-option key=\"2\" value=\"2\">否</a-select-option>\r\n          </a-select>\r\n        </a-form-model-item>\r\n      </a-form-model>\r\n      </a-modal>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nconst columns = [\r\n  {\r\n    title: 'ID',\r\n    dataIndex: 'ID',\r\n    width: '10%',\r\n    key: 'id',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '用户名',\r\n    dataIndex: 'username',\r\n    width: '20%',\r\n    key: 'username',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '角色',\r\n    dataIndex: 'role',\r\n    width: '20%',\r\n    key: 'role',\r\n    align: 'center',\r\n    scopedSlots: { customRender: 'role' }\r\n  },\r\n  {\r\n    title: '操作',\r\n    width: '30%',\r\n    key: 'action',\r\n    align: 'center',\r\n    scopedSlots: { customRender: 'action' }\r\n  }\r\n]\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      pagination: {\r\n        pageSizeOptions: ['5', '10', '20'],\r\n        defaultCurrent: 1,\r\n        defaultPageSize: 5,\r\n        total: 0,\r\n        showSizeChanger: true,\r\n        showTotal: (total) => `共${total}条`\r\n      },\r\n      userList: [],\r\n      columns,\r\n      queryParam: {\r\n        username: '',\r\n        pagesize: 5,\r\n        pagenum: 1\r\n      },\r\n      userinfo: {\r\n        id: 0,\r\n        username: '',\r\n        password: '',\r\n        checkpass: '',\r\n        role: 2\r\n      },\r\n      userRules: {\r\n        password: [{\r\n          validator: (rule, value, callback) => {\r\n            if (value === '') {\r\n              callback(new Error('请输入密码'))\r\n            }\r\n            if (value.length < 6 || value.length > 20) {\r\n              callback(new Error('密码应当在6到20为之间'))\r\n            } else {\r\n              callback()\r\n            }\r\n          },\r\n          trigger: 'blur'\r\n        }]\r\n      },\r\n      addUserVisible: false,\r\n      visible: false\r\n    }\r\n  },\r\n  created () {\r\n    this.getUserList()\r\n  },\r\n  methods: {\r\n    async getUserList () {\r\n      const { data: res } = await this.$http.get('users', {\r\n        params: {\r\n          username: this.queryParam.username,\r\n          pagesize: this.queryParam.pagesize,\r\n          pagenum: this.queryParam.pagenum\r\n        }\r\n      })\r\n      if (res.status !== 200) return this.$message.error(res.message)\r\n      this.userList = res.data\r\n      this.pagination.total = res.total\r\n    },\r\n    // 修改分页时触发\r\n    handleTableChange (pagination, filters, sorter) {\r\n      const pager = this.pagination\r\n      pager.current = pagination.current\r\n      pager.pageSize = pagination.pageSize\r\n      this.queryParam.pagesize = pagination.pageSize\r\n      this.queryParam.pagenum = pagination.current\r\n      if (pagination.pageSize !== this.pagination.pageSize) {\r\n        this.queryParam.pagenum = 1\r\n        pager.current = 1\r\n      }\r\n      this.pagination = pager\r\n      this.getUserList()\r\n    },\r\n    // 删除用户\r\n    deleteUser (id) {\r\n      this.$confirm({\r\n        title: '确定删除该用户吗？',\r\n        content: '一旦删除，无法恢复',\r\n        onOk: async () => {\r\n          const res = await this.$http.delete(`user/${id}`)\r\n          console.log(res)\r\n          if (res.status !== 200) return this.$message.error(res.message)\r\n          this.$message.success('删除成功')\r\n          this.getUserList()\r\n        },\r\n        onCancel: async () => {\r\n          this.$message.info('已取消删除')\r\n        }\r\n      })\r\n    },\r\n    // 新增用户\r\n    addUserOk () {\r\n\r\n    },\r\n    addUserCancel () {\r\n      this.addUserVisible = false\r\n    },\r\n    adminChange (value) {\r\n      this.userinfo.role = value\r\n      console.log(this.userinfo.role)\r\n    }\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.actionSlot{\r\n    display: flex;\r\n    justify-content: center;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}