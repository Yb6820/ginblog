{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { Url } from '../../plugins/http';\nexport default {\n  props: ['id'],\n  data() {\n    return {\n      artInfo: {\n        id: 0,\n        title: '',\n        cid: undefined,\n        desc: '',\n        content: '',\n        img: ''\n      },\n      artInfoRules: {\n        title: [{\n          required: true,\n          message: '请输入文章标题',\n          trigger: 'blur'\n        }],\n        cid: [{\n          required: true,\n          message: '请输入文章分类',\n          trigger: 'change'\n        }],\n        desc: [{\n          required: true,\n          message: '请输入文章描述',\n          trigger: 'blur'\n        }, {\n          max: 120,\n          message: '描述最多不超过120字符',\n          trigger: 'change'\n        }],\n        img: [{\n          required: true,\n          message: '请选择文章缩略图',\n          trigger: 'blur'\n        }],\n        content: [{\n          required: true,\n          message: '请输入文章内容',\n          trigger: 'blur'\n        }]\n      },\n      Catelist: [],\n      upUrl: Url + 'upload',\n      headers: {}\n    };\n  },\n  created() {\n    this.getCateList();\n    this.headers = {\n      Authorization: `Bearer ${window.sessionStorage.getItem('token')}`\n    };\n    if (this.id) {\n      this.getArtInfo(this.id);\n    }\n  },\n  methods: {\n    // 查询文章信息\n    async getArtInfo(id) {\n      const {\n        data: res\n      } = await this.$http.get(`article/${id}`);\n      if (res.status !== 200) return this.$message.error(res.message);\n      this.artInfo = res.data;\n      this.artInfo.id = res.data.ID;\n    },\n    // 获取分类列表\n    async getCateList() {\n      const {\n        data: res\n      } = await this.$http.get('categories');\n      if (res.status !== 200) return this.$message.error(res.error);\n      this.Catelist = res.data;\n    },\n    // 切换选择分类时触发\n    /* cateChange (value) {\r\n      this.artInfo.cid = value\r\n    } */\n    // 上传图片\n    upChange(info) {\n      if (info.file.status !== 'uploading') {\n        console.log(info.file, info.fileList);\n      }\n      if (info.file.status === 'done') {\n        this.$message.success('图片上传成功');\n        this.artInfo.img = info.file.response.url;\n      } else if (info.file.status === 'error') {\n        this.$message.error('图片上传失败');\n      }\n    },\n    // 提交或者更新文章\n    artSubmit(id) {\n      this.$refs.artInfoRef.validate(async valid => {\n        if (id === 0) {\n          const {\n            data: res\n          } = await this.$http.post('article/add', this.artInfo);\n          if (res.status !== 200) return this.$message.error(res.message);\n          this.$message.success('添加文章成功');\n          this.$router.push('/admin/artlist');\n        } else {\n          const {\n            data: res\n          } = await this.$http.put(`article/${id}`, this.artInfo);\n          if (res.status !== 200) return this.$message.error(res.message);\n          this.$message.success('更新文章成功');\n          this.$router.push('/admin/artlist');\n        }\n      });\n    },\n    addCancel() {\n      this.$refs.artInfoRef.resetFields();\n    }\n  }\n};","map":{"version":3,"names":["Url","props","data","artInfo","id","title","cid","undefined","desc","content","img","artInfoRules","required","message","trigger","max","Catelist","upUrl","headers","created","getCateList","Authorization","window","sessionStorage","getItem","getArtInfo","methods","res","$http","get","status","$message","error","ID","upChange","info","file","console","log","fileList","success","response","url","artSubmit","$refs","artInfoRef","validate","valid","post","$router","push","put","addCancel","resetFields"],"sources":["src/components/article/AddArt.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <h3>{{ id?'编辑文章':'新增文章' }}</h3>\r\n        <a-card>\r\n            <a-form-model :model=\"artInfo\" ref=\"artInfoRef\" :rules=\"artInfoRules\" :hideRequiredMark=\"true\">\r\n                <a-form-model-item label=\"文章标题\" prop=\"title\">\r\n                    <a-input style=\"width:300px\" v-model=\"artInfo.title\"></a-input>\r\n                </a-form-model-item>\r\n                <a-form-model-item label=\"文章描述\" prop=\"desc\">\r\n                      <a-input type=\"textarea\" v-model=\"artInfo.desc\"></a-input>\r\n                </a-form-model-item>\r\n                <a-form-model-item label=\"文章分类\" prop=\"cid\">\r\n                    <a-select style=\"width:200px\" v-model=\"artInfo.cid\" placeholder=\"请选择分类\">\r\n                        <a-select-option v-for=\"item in Catelist\" :key=\"item.id\" :value=\"item.id\">\r\n                            {{ item.name }}\r\n                        </a-select-option>\r\n                    </a-select>\r\n                </a-form-model-item>\r\n                <a-form-model-item label=\"文章缩略图\" prop=\"img\">\r\n                    <a-upload\r\n                    list-type=\"picture\"\r\n                    name=\"file\"\r\n                    :multiple=\"false\"\r\n                    :action=\"upUrl\"\r\n                    :headers=\"headers\"\r\n                    @change=\"upChange\"\r\n                    >\r\n                    <a-button> <a-icon type=\"upload\" /> 点击上传 </a-button>\r\n                    <br/>\r\n                    <template v-if=\"id\">\r\n                      <img :src=\"artInfo.img\" style=\"width:150px;height:80px\">\r\n                    </template>\r\n                    </a-upload>\r\n                </a-form-model-item>\r\n                <a-form-model-item label=\"文章内容\" prop=\"content\">\r\n                </a-form-model-item>\r\n                <a-form-model-item>\r\n                    <a-button type=\"primary\" style=\"margin-right:15px\" @click=\"artSubmit(artInfo.id)\"> {{ artInfo.id?'更新':'提交' }} </a-button>\r\n                    <a-button type=\"danger\" @click=\"addCancel\">取消</a-button>\r\n                </a-form-model-item>\r\n            </a-form-model>\r\n        </a-card>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { Url } from '../../plugins/http'\r\nexport default {\r\n  props: ['id'],\r\n  data () {\r\n    return {\r\n      artInfo: {\r\n        id: 0,\r\n        title: '',\r\n        cid: undefined,\r\n        desc: '',\r\n        content: '',\r\n        img: ''\r\n      },\r\n      artInfoRules: {\r\n        title: [{ required: true, message: '请输入文章标题', trigger: 'blur' }],\r\n        cid: [{ required: true, message: '请输入文章分类', trigger: 'change' }],\r\n        desc: [\r\n          { required: true, message: '请输入文章描述', trigger: 'blur' },\r\n          { max: 120, message: '描述最多不超过120字符', trigger: 'change' }\r\n        ],\r\n        img: [{ required: true, message: '请选择文章缩略图', trigger: 'blur' }],\r\n        content: [{ required: true, message: '请输入文章内容', trigger: 'blur' }]\r\n\r\n      },\r\n      Catelist: [],\r\n      upUrl: Url + 'upload',\r\n      headers: {}\r\n    }\r\n  },\r\n  created () {\r\n    this.getCateList()\r\n    this.headers = { Authorization: `Bearer ${window.sessionStorage.getItem('token')}` }\r\n    if (this.id) {\r\n      this.getArtInfo(this.id)\r\n    }\r\n  },\r\n  methods: {\r\n    // 查询文章信息\r\n    async getArtInfo (id) {\r\n      const { data: res } = await this.$http.get(`article/${id}`)\r\n      if (res.status !== 200) return this.$message.error(res.message)\r\n      this.artInfo = res.data\r\n      this.artInfo.id = res.data.ID\r\n    },\r\n    // 获取分类列表\r\n    async getCateList () {\r\n      const { data: res } = await this.$http.get('categories')\r\n      if (res.status !== 200) return this.$message.error(res.error)\r\n      this.Catelist = res.data\r\n    },\r\n    // 切换选择分类时触发\r\n    /* cateChange (value) {\r\n      this.artInfo.cid = value\r\n    } */\r\n    // 上传图片\r\n    upChange (info) {\r\n      if (info.file.status !== 'uploading') {\r\n        console.log(info.file, info.fileList)\r\n      }\r\n      if (info.file.status === 'done') {\r\n        this.$message.success('图片上传成功')\r\n        this.artInfo.img = info.file.response.url\r\n      } else if (info.file.status === 'error') {\r\n        this.$message.error('图片上传失败')\r\n      }\r\n    },\r\n    // 提交或者更新文章\r\n    artSubmit (id) {\r\n      this.$refs.artInfoRef.validate(async (valid) => {\r\n        if (id === 0) {\r\n          const { data: res } = await this.$http.post('article/add', this.artInfo)\r\n          if (res.status !== 200) return this.$message.error(res.message)\r\n          this.$message.success('添加文章成功')\r\n          this.$router.push('/admin/artlist')\r\n        } else {\r\n          const { data: res } = await this.$http.put(`article/${id}`, this.artInfo)\r\n          if (res.status !== 200) return this.$message.error(res.message)\r\n          this.$message.success('更新文章成功')\r\n          this.$router.push('/admin/artlist')\r\n        }\r\n      })\r\n    },\r\n    addCancel () {\r\n      this.$refs.artInfoRef.resetFields()\r\n    }\r\n  }\r\n}\r\n</script>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}