{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { Url } from '../../plugin/http';\nimport Editor from '../editor/index';\nexport default {\n  components: {\n    Editor\n  },\n  props: ['id'],\n  data() {\n    return {\n      artInfo: {\n        id: 0,\n        title: '',\n        cid: undefined,\n        desc: '',\n        content: '',\n        img: ''\n      },\n      Catelist: [],\n      upUrl: Url + 'upload',\n      headers: {},\n      fileList: [],\n      artInfoRules: {\n        title: [{\n          required: true,\n          message: '请输入文章标题',\n          trigger: 'change'\n        }],\n        cid: [{\n          required: true,\n          message: '请选择文章分类',\n          trigger: 'change'\n        }],\n        desc: [{\n          required: true,\n          message: '请输入文章描述',\n          trigger: 'change'\n        }, {\n          max: 120,\n          message: '描述最多可写120个字符',\n          trigger: 'change'\n        }],\n        // img: [{ required: true, message: '请选择文章缩略图', trigger: 'change' }],\n        content: [{\n          required: true,\n          message: '请输入文章内容',\n          trigger: 'change'\n        }]\n      }\n    };\n  },\n  mounted() {\n    this.getCateList();\n    this.headers = {\n      Authorization: `Bearer ${window.sessionStorage.getItem('token')}`\n    };\n    if (this.id) {\n      this.getArtInfo(this.id);\n    }\n  },\n  methods: {\n    // 查询文章信息\n    async getArtInfo(id) {\n      const {\n        data: res\n      } = await this.$http.get(`admin/article/info/${id}`);\n      if (res.status !== 200) {\n        if (res.status === (1004 || 1005 || 1006 || 1007)) {\n          window.sessionStorage.clear();\n          this.$message.error(res.message);\n          this.$router.push('/login');\n          return;\n        }\n        this.$message.error(res.message);\n        return;\n      }\n      this.artInfo = res.data;\n      this.artInfo.id = res.data.ID;\n    },\n    // 获取分类列表\n    async getCateList() {\n      const {\n        data: res\n      } = await this.$http.get('admin/category');\n      if (res.status !== 200) return this.$message.error(res.message);\n      this.Catelist = res.data;\n    },\n    // 选择分类\n    cateChange(value) {\n      this.artInfo.cid = value;\n    },\n    // 上传图片\n    upChange(info) {\n      // if (info.file.status !== 'uploading') { }\n      if (info.file.status === 'done') {\n        this.$message.success('图片上传成功');\n        this.artInfo.img = info.file.response.url;\n      } else if (info.file.status === 'error') {\n        this.$message.error('图片上传失败');\n      }\n    },\n    // 提交&&更新文章\n    artOk(id) {\n      this.$refs.artInfoRef.validate(async valid => {\n        if (!valid) return this.$message.error('参数验证未通过，请按要求录入文章内容');\n        if (id === 0) {\n          const {\n            data: res\n          } = await this.$http.post('article/add', this.artInfo);\n          if (res.status !== 200) return this.$message.error(res.message);\n          this.$router.push('/artlist');\n          this.$message.success('添加文章成功');\n        } else {\n          const {\n            data: res\n          } = await this.$http.put(`article/${id}`, this.artInfo);\n          if (res.status !== 200) return this.$message.error(res.message);\n          this.$router.push('/artlist');\n          this.$message.success('更新文章成功');\n        }\n      });\n    },\n    addCancel() {\n      this.$refs.artInfoRef.resetFields();\n    }\n  }\n};","map":{"version":3,"names":["Url","Editor","components","props","data","artInfo","id","title","cid","undefined","desc","content","img","Catelist","upUrl","headers","fileList","artInfoRules","required","message","trigger","max","mounted","getCateList","Authorization","window","sessionStorage","getItem","getArtInfo","methods","res","$http","get","status","clear","$message","error","$router","push","ID","cateChange","value","upChange","info","file","success","response","url","artOk","$refs","artInfoRef","validate","valid","post","put","addCancel","resetFields"],"sources":["src/components/article/AddArt.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <a-card>\r\n            <h3>{{ id ? '编辑文章' : '新增文章' }}</h3>\r\n\r\n            <a-form-model :model=\"artInfo\" ref=\"artInfoRef\" :rules=\"artInfoRules\" :hideRequiredMark=\"true\">\r\n                <a-row :gutter=\"24\">\r\n                    <a-col :span=\"16\">\r\n                        <a-form-model-item label=\"文章标题\" prop=\"title\">\r\n                            <a-input style=\"width: 300px\" v-model=\"artInfo.title\"></a-input>\r\n                        </a-form-model-item>\r\n                        <a-form-model-item label=\"文章描述\" prop=\"desc\">\r\n                            <a-input type=\"textarea\" v-model=\"artInfo.desc\"></a-input>\r\n                        </a-form-model-item>\r\n                    </a-col>\r\n                    <a-col :span=\"8\">\r\n                        <a-form-model-item label=\"文章分类\" prop=\"cid\">\r\n                            <a-select style=\"width: 200px\" v-model=\"artInfo.cid\" placeholder=\"请选择分类\" @change=\"cateChange\">\r\n                                <a-select-option v-for=\"item in Catelist\" :key=\"item.id\" :value=\"item.id\">\r\n                                    {{\r\n                                        item.name\r\n                                    }}\r\n                                </a-select-option>\r\n                            </a-select>\r\n                        </a-form-model-item>\r\n\r\n                        <a-form-model-item label=\"文章缩略图\" prop=\"img\">\r\n                            <a-upload listType=\"picture\" name=\"file\" :action=\"upUrl\" :headers=\"headers\" @change=\"upChange\">\r\n                                <a-button>\r\n                                    <a-icon type=\"upload\" />点击上传\r\n                                </a-button>\r\n\r\n                                <template v-if=\"id\">\r\n                                    <img :src=\"artInfo.img\" style=\"width: 120px; height: 100px; margin-left: 15px\" />\r\n                                </template>\r\n                            </a-upload>\r\n                        </a-form-model-item>\r\n                    </a-col>\r\n                </a-row>\r\n                <a-form-model-item label=\"文章内容\" prop=\"content\">\r\n                    <Editor v-model=\"artInfo.content\"></Editor>\r\n                </a-form-model-item>\r\n\r\n                <a-form-model-item>\r\n                    <a-button type=\"danger\" style=\"margin-right: 15px\" @click=\"artOk(artInfo.id)\">\r\n                        {{\r\n                            artInfo.id ? '更新' : '提交'\r\n                        }}\r\n                    </a-button>\r\n                    <a-button type=\"primary\" @click=\"addCancel\">取消</a-button>\r\n                </a-form-model-item>\r\n            </a-form-model>\r\n        </a-card>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { Url } from '../../plugin/http'\r\nimport Editor from '../editor/index'\r\nexport default {\r\n  components: { Editor },\r\n  props: ['id'],\r\n  data () {\r\n    return {\r\n      artInfo: {\r\n        id: 0,\r\n        title: '',\r\n        cid: undefined,\r\n        desc: '',\r\n        content: '',\r\n        img: ''\r\n      },\r\n      Catelist: [],\r\n      upUrl: Url + 'upload',\r\n      headers: {},\r\n      fileList: [],\r\n      artInfoRules: {\r\n        title: [{ required: true, message: '请输入文章标题', trigger: 'change' }],\r\n        cid: [{ required: true, message: '请选择文章分类', trigger: 'change' }],\r\n        desc: [\r\n          { required: true, message: '请输入文章描述', trigger: 'change' },\r\n          { max: 120, message: '描述最多可写120个字符', trigger: 'change' }\r\n        ],\r\n        // img: [{ required: true, message: '请选择文章缩略图', trigger: 'change' }],\r\n        content: [{ required: true, message: '请输入文章内容', trigger: 'change' }]\r\n      }\r\n    }\r\n  },\r\n  mounted () {\r\n    this.getCateList()\r\n    this.headers = { Authorization: `Bearer ${window.sessionStorage.getItem('token')}` }\r\n    if (this.id) {\r\n      this.getArtInfo(this.id)\r\n    }\r\n  },\r\n  methods: {\r\n    // 查询文章信息\r\n    async getArtInfo (id) {\r\n      const { data: res } = await this.$http.get(`admin/article/info/${id}`)\r\n      if (res.status !== 200) {\r\n        if (res.status === (1004 || 1005 || 1006 || 1007)) {\r\n          window.sessionStorage.clear()\r\n          this.$message.error(res.message)\r\n          this.$router.push('/login')\r\n          return\r\n        }\r\n        this.$message.error(res.message)\r\n        return\r\n      }\r\n      this.artInfo = res.data\r\n      this.artInfo.id = res.data.ID\r\n    },\r\n    // 获取分类列表\r\n    async getCateList () {\r\n      const { data: res } = await this.$http.get('admin/category')\r\n      if (res.status !== 200) return this.$message.error(res.message)\r\n      this.Catelist = res.data\r\n    },\r\n    // 选择分类\r\n    cateChange (value) {\r\n      this.artInfo.cid = value\r\n    },\r\n    // 上传图片\r\n    upChange (info) {\r\n      // if (info.file.status !== 'uploading') { }\r\n      if (info.file.status === 'done') {\r\n        this.$message.success('图片上传成功')\r\n        this.artInfo.img = info.file.response.url\r\n      } else if (info.file.status === 'error') {\r\n        this.$message.error('图片上传失败')\r\n      }\r\n    },\r\n    // 提交&&更新文章\r\n    artOk (id) {\r\n      this.$refs.artInfoRef.validate(async (valid) => {\r\n        if (!valid) return this.$message.error('参数验证未通过，请按要求录入文章内容')\r\n        if (id === 0) {\r\n          const { data: res } = await this.$http.post('article/add', this.artInfo)\r\n          if (res.status !== 200) return this.$message.error(res.message)\r\n          this.$router.push('/artlist')\r\n          this.$message.success('添加文章成功')\r\n        } else {\r\n          const { data: res } = await this.$http.put(`article/${id}`, this.artInfo)\r\n          if (res.status !== 200) return this.$message.error(res.message)\r\n\r\n          this.$router.push('/artlist')\r\n          this.$message.success('更新文章成功')\r\n        }\r\n      })\r\n    },\r\n\r\n    addCancel () {\r\n      this.$refs.artInfoRef.resetFields()\r\n    }\r\n  }\r\n}\r\n</script>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}